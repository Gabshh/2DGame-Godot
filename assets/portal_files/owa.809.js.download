(window.$wj=window.$wj||[]).push([[809],{13161:function(e,n,i){"use strict";var t=i(47);function a(){return Object(t.j)("fwk-graphql-worker-link")&&Object(t.j)("fwk-offline-sync")}i.d(n,"a",(function(){return a}))},19662:function(e,n,i){"use strict";i.r(n);const t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"subscribeToHierarchyNotifications"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"subscribeToHierarchyNotifications"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"EventType"}},{kind:"Field",name:{kind:"Name",value:"folderId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"parentFolderId"}},{kind:"Field",name:{kind:"Name",value:"itemCount"}},{kind:"Field",name:{kind:"Name",value:"unreadCount"}}]}}]}}]};var a=i(705),d=i(2330),o=i(2641),r=i(2661),l=i(4680),c=i(611),u=i(3689),s=i(1701),m=i(4748),k=i(261),F=i(1678);function f(){const e=Object(l.a)({FolderShape:Object(u.a)({BaseShape:"IdOnly",AdditionalProperties:[Object(s.a)({FieldURI:"TotalCount"}),Object(s.a)({FieldURI:"UnreadCount"})]}),Paging:null,ParentFolderIds:[Object(c.a)({Id:Object(F.a)("msgfolderroot")})],ReturnParentFolder:!0,ShapeName:null,Traversal:"Deep"});return Object(m.a)({Header:Object(k.b)(),Body:e}).then(e=>{var n,i,t;return null===(t=null===(i=null===(n=null==e?void 0:e.Body)||void 0===n?void 0:n.ResponseMessages)||void 0===i?void 0:i.Items)||void 0===t?void 0:t[0]})}var v=i(36),b=i(6602),N=i(4167),p=i(13161),h=i(225);function y(e){switch(e.EventType){case"Reload":case"QueryResultChanged":f().then(e=>{"Success"==(null==e?void 0:e.ResponseClass)?e.RootFolder.Folders.forEach(e=>{Object(r.a)(e.UnreadCount,e.TotalCount,e.FolderId.Id,!1)}):v.h.warn(O+"ResponseNotSuccess")}).catch(e=>{v.h.warn(O+":"+e.message)});break;case"RowModified":Object(o.b)(e.unreadCount,e.itemCount,e.folderId,e.displayName,e.parentFolderId),d.h.import().then(n=>{n(e)});break;case"RowAdded":Object(o.a)(e.folderId,e.parentFolderId,e.displayName,e.unreadCount,e.itemCount),d.h.import().then(n=>{n(e)});break;default:return}}function g(){const e=Object(a.a)();Object(b.a)(()=>e.subscribe({query:t}),{next:e=>{y(e.data.subscribeToHierarchyNotifications),Object(p.a)()&&N.b.importAndExecute(Object(h.d)(),e.data.subscribeToHierarchyNotifications)},error:e=>{v.h.warn(`Hierarchy notification error ${e}`),y({EventType:"Reload"})}},"HierarchyNotifications")}const O="UpdateFolderCountsAction:";const j={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"FolderUpdateNotification"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"UnreadCount"}},{kind:"Field",name:{kind:"Name",value:"totalMessageCount"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"parentFolderId"}}]}}]},C={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"NewFolder"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"changeKey"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"parentFolderId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"distinguishedFolderType"}},{kind:"Field",name:{kind:"Name",value:"FolderClass"}},{kind:"Field",name:{kind:"Name",value:"UnreadCount"}},{kind:"Field",name:{kind:"Name",value:"totalMessageCount"}},{kind:"Field",name:{kind:"Name",value:"childFolderCount"}},{kind:"Field",name:{kind:"Name",value:"childFolderIds"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"mailboxInfo"}},{kind:"Field",name:{kind:"Name",value:"remoteFolderInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"remoteFolderDisplayName"}}]}}]}}]};var I=i(20),S=i(8892),w=i(13),D=i(4942);const T=Object(I.e)(o.a,"onNewFolderNotificationClone",async e=>{if(!Object(w.i)("gqlfolders"))return;const{displayName:n,parentFolderId:i,folderId:t,unreadCount:d,totalCount:o}=e,r=await Object(S.a)(i,t);if(!r)return;const l=Object(a.a)();l.writeFragment({id:Object(D.a)(t,l),fragment:C,data:{id:t,changeKey:null,UnreadCount:d,totalMessageCount:o,displayName:n,parentFolderId:r.id,mailboxInfo:r.mailboxInfo,remoteFolderInfo:{remoteFolderDisplayName:n},distinguishedFolderType:null,childFolderIds:[],childFolderCount:0,type:"Folder:#Exchange",FolderClass:"IPF.Note",__typename:"MailFolder"}})}),R=Object(I.e)(o.b,"onUpdateFolderNotificationClone",async e=>{if(!Object(w.i)("gqlfolders"))return;const{folderId:n,unreadCount:i,totalCount:t,displayName:d,parentFolderId:o}=e,r=Object(a.a)();if(!r.readFragment({id:Object(D.a)(n,r),fragment:j}))return;const l=await Object(S.a)(o,n);l&&r.writeFragment({id:Object(D.a)(n,r),fragment:j,data:{UnreadCount:i,totalMessageCount:t,displayName:d,parentFolderId:l.id}})});i.d(n,"subscribeToHierarchyNotification",(function(){return g})),i.d(n,"onNewFolderNotificationOrchestrator",(function(){return T})),i.d(n,"onUpdateFolderNotificationOrchestrator",(function(){return R}))},3689:function(e,n,i){"use strict";function t(e){return Object.assign({__type:"FolderResponseShape:#Exchange"},e)}i.d(n,"a",(function(){return t}))},4022:function(e,n,i){"use strict";let t;function a(e){t=e}function d(){return t}i.d(n,"b",(function(){return a})),i.d(n,"a",(function(){return d}))},4167:function(e,n,i){"use strict";i.d(n,"a",(function(){return o})),i.d(n,"c",(function(){return r})),i.d(n,"b",(function(){return l}));var t=i(4),a=i(4022);i.d(n,"d",(function(){return a.b}));const d=new t.d(()=>i.e(660).then(i.bind(null,7341))),o=new t.a(d,e=>e.executeRequest),r=new t.a(d,e=>e.unsubscribe),l=new t.a(d,e=>e.onHierarchyNotification)},4680:function(e,n,i){"use strict";function t(e){return Object.assign({__type:"FindFolderRequest:#Exchange"},e)}i.d(n,"a",(function(){return t}))},4748:function(e,n,i){"use strict";var t=i(35);function a(e,n){var i;return void 0===e||e.__type||(i=e,e=Object.assign({__type:"FindFolderJsonRequest:#Exchange"},i)),Object(t.a)("FindFolder",e,n)}i.d(n,"a",(function(){return a}))},4942:function(e,n,i){"use strict";function t(e,n){const i={__typename:"MailFolder",id:e};return n.cache.identify(i)}i.d(n,"a",(function(){return t}))},5709:function(e,n,i){"use strict";i.d(n,"a",(function(){return t})),i.d(n,"d",(function(){return a})),i.d(n,"c",(function(){return d})),i.d(n,"b",(function(){return o}));const t={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"FolderChildFolderIds"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"childFolderIds"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"childFolderCount"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"changeKey"}},{kind:"Field",name:{kind:"Name",value:"mailboxInfo"}}]}}]},a={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"UpdateFolderChildFolderIds"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"childFolderIds"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"childFolderCount"}}]}}]},d={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"FolderParentFolder"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"parentFolderId"}},{kind:"Field",name:{kind:"Name",value:"mailboxInfo"}}]}}]},o={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"FolderCounts"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"UnreadCount"}},{kind:"Field",name:{kind:"Name",value:"totalMessageCount"}}]}}]}},6602:function(e,n,i){"use strict";var t=i(71),a=i(2),d=i(567),o=i(36);const r=10;function l(e,n,i){let l,c=0;const u={next:e=>{var i;return null===(i=n.next)||void 0===i?void 0:i.call(n,e)},complete:()=>{var e;return null===(e=n.complete)||void 0===e?void 0:e.call(n)},error:s=>{var m;Object(t.o)("GraphqlSubscriptionError",{owa_1:i,owa_2:Object(a.U)(null==s?void 0:s.toString()),owa_3:Object(a.U)(null==s?void 0:s.stack),owa_4:c},{isCore:!0}),Object(d.isApolloError)(s)&&(c++<r?(null==l||l.unsubscribe(),l=e().subscribe(u)):Object(o.d)(`${i}: too many apollo errors`)),null===(m=n.error)||void 0===m||m.call(n,s)}};return l=e().subscribe(u),{closed:!l||l.closed,unsubscribe:()=>null==l?void 0:l.unsubscribe()}}i.d(n,"a",(function(){return l}))},7611:function(e,n,i){"use strict";i.d(n,"a",(function(){return o}));var t=i(5709),a=i(705),d=i(4942);async function o(e,n){const i=Object(a.a)(),o=i.readFragment({id:Object(d.a)(e,i),fragment:t.c});if(!o)return;const r=o.parentFolderId;if(r==n)return;const l=i.readFragment({id:Object(d.a)(r,i),fragment:t.a});if(!l)return null;const c=[...l.childFolderIds],u=c.indexOf(e);u>-1&&(c.splice(u,1),i.writeFragment({id:Object(d.a)(r,i),fragment:t.d,data:{childFolderIds:[...c],childFolderCount:c.length}}))}},8892:function(e,n,i){"use strict";i.d(n,"a",(function(){return r}));var t=i(5709),a=i(705),d=i(4942),o=i(7611);async function r(e,n){const i=Object(a.a)();await Object(o.a)(n,e);const r=i.readFragment({id:Object(d.a)(e,i),fragment:t.a});if(!r)return null;const l=r.childFolderIds;return l.includes(n)||i.writeFragment({id:Object(d.a)(e,i),fragment:t.d,data:{childFolderIds:[...l,n],childFolderCount:l.length}}),i.readFragment({id:Object(d.a)(e,i),fragment:t.a})}}}]);
//# sourceMappingURL=owa.809.js.map
self.scriptsLoaded = self.scriptsLoaded || {};self.scriptsLoaded['owa.809.js'] = 1;