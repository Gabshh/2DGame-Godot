(window.$wj=window.$wj||[]).push([[248],{1015:function(t,e,n){"use strict";var r;n.d(e,"a",(function(){return r})),function(t){t[t.Add=0]="Add",t[t.Init=1]="Init"}(r||(r={}))},1020:function(t,e,n){"use strict";function r(t){return Object.assign({__type:"GetUserUnifiedGroupsRequest:#Exchange"},t)}n.d(e,"a",(function(){return r}))},1021:function(t,e,n){"use strict";var r=n(35);function o(t,e){var n;return void 0===t||t.__type||(n=t,t=Object.assign({__type:"GetUserUnifiedGroupsJsonRequest:#Exchange"},n)),Object(r.a)("GetUserUnifiedGroups",t,e)}n.d(e,"a",(function(){return o}))},1091:function(t,e,n){"use strict";var r=n(3),o=Object(r.createStore)("calendarAccountInitializationStateStore",{isAllCalendarAccountsAndCacheLoaded:!1});const c=Object(r.action)("allCalendarAccountsAndCacheLoaded",(t,e)=>({isSuccess:t,userIdentity:e})),a=Object(r.action)("removedConnectedAccountIdCleanup");function u(){return o().isAllCalendarAccountsAndCacheLoaded}Object(r.mutator)(c,t=>{t.isSuccess&&(o().isAllCalendarAccountsAndCacheLoaded=!0)}),n.d(e,"a",(function(){return c})),n.d(e,"c",(function(){return a})),n.d(e,"b",(function(){return u}))},1094:function(t,e,n){"use strict";n.d(e,"c",(function(){return c})),n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return u}));var r=n(20);const o=new r.c(()=>Promise.all([n.e(1),n.e(2),n.e(3),n.e(19),n.e(522)]).then(n.bind(null,1608))),c=new r.a(o,t=>t.initializeSelectedTeamsCalendars),a=new r.a(o,t=>t.getSelectedTeamsCalendars),u=new r.a(o,t=>t.createCalendarCacheInfoFromTeamsChannel)},1096:function(t,e,n){"use strict";var r=n(71),o=n(145);const c="Groups";var a=n(225),u=n(261),i=n(704),d=n(1021),s=n(1020),l=n(1099),f=n(6);async function b(t){const e=await async function(t){let e=[];e.push({FilterType:1,SortType:4,SortDirection:"Descending"}),e.push({FilterType:2,SortType:4,SortDirection:"Descending"});const n=Object(u.b)();n.RequestServerVersion="V2018_01_08";const r=Object(i.a)(Object(a.d)(t));return await Object(d.a)({Header:n,Body:Object(s.a)({RequestedGroupsSets:e})},r)}(t);return null!=e&&e.Body.GroupsSets&&e.Body.GroupsSets.length>0?function(t,e){const n=[],r=Object(o.r)(e,c);if(t.forEach(t=>{t.Groups.forEach(t=>{var o;let c=t.SmtpAddress.toLowerCase(),a={calendarId:{id:c,mailboxInfo:{type:"GroupMailbox",userIdentity:e,mailboxSmtpAddress:c}},CalendarColor:-1,CalendarName:t.DisplayName,OwnerEmailAddress:c,OwnerName:t.DisplayName,IsGroupMailboxCalendar:!0,IsGeneralScheduleCalendar:!0,ParentGroupId:r,CanShare:!1,__typename:"LinkedCalendarEntry"};n.push({entry:a,groupMailboxGuid:null===(o=t.MailboxGuid)||void 0===o?void 0:o.toLowerCase()})})}),n.length>0){const t={calendarGroupId:{id:r,mailboxInfo:{type:"GroupMailbox",userIdentity:e,mailboxSmtpAddress:e}},serverGroupId:r,GroupName:Object(f.b)(l.a),GroupType:3};return{groupCalendars:n,calendarGroup:t}}return null}(e.Body.GroupsSets,t):null}var I=n(248);var O=n(296);async function m(t){const e=await b(t),n=Object(O.a)(t)?function(t){var e;let n=Object(o.k)().filter(t=>Object(I.m)(t));if(0==n.length)return t;const r=[];for(let o=0;o<(null===(e=null==t?void 0:t.groupCalendars)||void 0===e?void 0:e.length);o++){const e=t.groupCalendars[o];n.some(t=>{var n,r;const o=t;return(null===(n=o.OwnerEmailAddress)||void 0===n?void 0:n.toLowerCase())===e.entry.calendarId.mailboxInfo.mailboxSmtpAddress&&(null===(r=o.SharedOwnerMailboxGuid)||void 0===r?void 0:r.toLowerCase())===e.groupMailboxGuid})||r.push(e)}return(null==r?void 0:r.length)>0?{groupCalendars:r,calendarGroup:t.calendarGroup}:null}(e):e;return null!=n&&null!=n.groupCalendars?(n.groupCalendars.forEach(t=>{Object(o.b)(t.entry)}),Object(o.a)(n.calendarGroup),{group:n.calendarGroup}):null}var p=n(57);async function v(t,e){var n;const u=new r.b("initializeGroupCalendars");t||(t=Object(a.d)().userIdentity);const i=!!(null===(n=Object(p.h)(t))||void 0===n?void 0:n.GroupsEnabled),d=Object(o.r)(t,c),s=!Object(o.t)().some(e=>e.serverGroupId===d&&e.calendarGroupId.mailboxInfo.userIdentity===t),l=i&&(e||s);u.addCustomData({issueServiceCall:l,GroupsEnabled:i,featureEnabled:!0,refresh:e,initialLoad:s});try{l&&await m(t),u.end()}catch(t){throw u.endWithError("ServerError",Error(t)),t}}n.d(e,"b",(function(){return v})),n.d(e,"a",(function(){return c}))},1098:function(t,e,n){"use strict";let r;function o(t){return r=null==t?void 0:t.getCalendarFolders,t}function c(){let t=r;return r=void 0,t}n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return c}))},1099:function(t){t.exports=JSON.parse('{"a":"XNa"}')},11009:function(t,e,n){"use strict";var r=n(7812),o=n(9204),c=n(20);const a=new c.c(()=>n.e(688).then(n.bind(null,19818))),u=new c.a(a,t=>t.loadWorkloadScenarioSettings);n.d(e,"a",(function(){return d}));let i=!1;async function d(){if(i)return;i=!0;const t=[Object(o.a)(),u.importAndExecute()];r.a.importModule("calendarAutoSelect"),await Promise.all(t)}},2120:function(t,e,n){"use strict";var r=n(248);function o(t,e){return!t.some(t=>{var n,o;return t&&e&&(null===(n=Object(r.j)(t))||void 0===n?void 0:n.Id)===(null===(o=Object(r.j)(e))||void 0===o?void 0:o.Id)})}function c(t,e){return t.indexOf(e)<0}function a(t,e=c){if(!t)return[];const n=[];return t&&t.forEach(t=>{e(n,t)&&n.push(t)}),n}var u=n(16);function i(t,e=c){if(!t)return t;const n=new u.ObservableMap;return t.forEach((t,r)=>{n.set(r,a(t,e))}),n}function d(t,e=c){if(!t)return[];const n=[];return t.forEach(t=>{t&&t.forEach(t=>{e(n,t)&&n.push(t)})}),n}n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return i})),n.d(e,"d",(function(){return d}))},2386:function(t,e,n){"use strict";var r;!function(t){t.EwsId="ews",t.EwsImmutableId="ewsimmutable"}(r||(r={}));var o=n(47),c=n(3),a=Object(c.createStore)("immutableId",{IsImmutableIdFeatureOnForConnectedAccount:!1});var u=n(287);function i(t){return Object(u.r)(t)?a().IsImmutableIdFeatureOnForConnectedAccount?r.EwsImmutableId:r.EwsId:Object(o.j)("fwk-immutable-ids")?r.EwsImmutableId:r.EwsId}function d(t){return!!t&&t.length<90}function s(t){const e=[],n=[],r=[];return null==t||t.forEach((t,o)=>{"string"==typeof t&&(t.indexOf("@")>-1?r.push({id:t,idx:o}):d(t)?e.push({id:t,idx:o}):n.push({id:t,idx:o}))}),[e,n,r]}function l(t,e){const[n,o]=s(t),c=i(e);return c===r.EwsImmutableId&&o.length>0||c===r.EwsId&&n.length>0}const f=Object(c.mutatorAction)("setIsImmutableIdFeatureOnForConnectedAccount",t=>{a().IsImmutableIdFeatureOnForConnectedAccount=t});n.d(e,"b",(function(){return i})),n.d(e,"e",(function(){return s})),n.d(e,"c",(function(){return l})),n.d(e,"d",(function(){return d})),n.d(e,"f",(function(){return f})),n.d(e,"a",(function(){return r}))},248:function(t,e,n){"use strict";const r="LinkedCalendarEntry",o="LocalCacheForRemoteCalendarEntry";function c(t){return(null==t?void 0:t.__typename)==r}function a(t){return(null==t?void 0:t.__typename)==o}function u(t){return(null==t?void 0:t.__typename)==r&&!(null==t?void 0:t.IsGroupMailboxCalendar)}function i(t){var e;return(null===(e=t)||void 0===e?void 0:e.CanViewPrivateItems)||c(t)}const d="_CHANNELTEAMSTYPE_";function s(t){return t.split(d)[0]}function l(t,e){return[t,e].join(d)}function f(t){if(t.FolderId)return t.FolderId;let e=t;return e.IsGeneralScheduleCalendar?{Id:e.OwnerEmailAddress,ChangeKey:""}:e.SharedFolderId?{Id:e.SharedFolderId.Id,ChangeKey:null!=e.SharedFolderId.ChangeKey?e.SharedFolderId.ChangeKey:""}:null}function b(t){return t&&!!t.ProviderId}function I(t){return t&&(null==t.IsRemovable||t.IsRemovable)&&(null==t.CalendarFolderType||3!=t.CalendarFolderType)&&!t.IsGroupMailboxCalendar}function O(t){return t&&I(t)&&!c(t)&&(!t.FolderId||!b(t))}function m(t){return t&&!t.IsGroupMailboxCalendar}function p(t){return t&&void 0!==t.FolderId}function v(t){return O(t)||m(t)||p(t)}n.d(e,"l",(function(){return c})),n.d(e,"m",(function(){return a})),n.d(e,"n",(function(){return u})),n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return"LocalCalendarEntry"})),n.d(e,"h",(function(){return i})),n.d(e,"i",(function(){return s})),n.d(e,"o",(function(){return l})),n.d(e,"j",(function(){return f})),n.d(e,"e",(function(){return I})),n.d(e,"g",(function(){return O})),n.d(e,"d",(function(){return m})),n.d(e,"c",(function(){return p})),n.d(e,"f",(function(){return v})),n.d(e,"k",(function(){return b}))},2654:function(t,e,n){"use strict";var r,o=n(4);!function(t){t.SelectedCalendars="SelectedCalendars",t.MyDay="MyDay",t.SavedCalendarViews="SavedCalendarViews",t.BoardCalendarAsset="BoardCalendarAsset",t.Spotlight="Spotlight",t.CalendarWidget="CalendarWidget",t.Addins="Addins",t.ActivityFeed="ActivityFeed",t.ReadingPane="ReadingPane",t.SXSAttachments="SXSAttachments",t.BoardMailItem="BoardMailItem"}(r||(r={})),n.d(e,"b",(function(){return u})),n.d(e,"e",(function(){return i})),n.d(e,"c",(function(){return d})),n.d(e,"d",(function(){return s})),n.d(e,"a",(function(){return r}));const c=new o.d(()=>n.e(872).then(n.bind(null,19655))),a=(t,e)=>{const n=new o.a(t,e);return(...t)=>n.importAndExecute(...t)},u=a(c,t=>t.convertIdsToTargetFormat),i=a(c,t=>t.translateRestImmutableIdsToEwsIds),d=a(c,t=>t.translateEwsIdsToEwsImmutableIds),s=a(c,t=>t.translateEwsIdsToRestImmutableIds);a(c,t=>t.translateEwsImmutableIdsToEwsIds)},2895:function(t,e,n){"use strict";var r=n(3);const o=Object(r.action)("UPDATE_SELECTED_CALENDARS_IN_STORE",(t,e)=>({calendarIds:t,userIdentity:e})),c=Object(r.action)("ADD_SELECTED_CALENDAR_IN_STORE",(t,e)=>({calendarId:t,userIdentity:e})),a=Object(r.action)("FORMAT_INITIAL_SELECTED_CALENDARS",(t,e)=>({ids:t,userIdentity:e}));const u={selectedCalendars:new(n(16).ObservableMap)},i=Object(r.createStore)("selectedCalendarsStore",u);var d=n(2120);function s(){return Object(d.c)(i().selectedCalendars)}function l(){return Object(d.d)(s())}function f(t){const e=s().get(t);return e||[]}Object(r.mutator)(o,t=>{const{calendarIds:e,userIdentity:n}=t;i().selectedCalendars.set(n,Object(d.b)(e))}),Object(r.mutator)(c,t=>{const{calendarId:e,userIdentity:n}=t;i().selectedCalendars.set(n,Object(d.b)([...f(n),e]))});const b=Object(r.action)("UPDATE_SELECTED_CALENDARS",(t,e)=>({calendarIds:t,userIdentity:e})),I=Object(r.action)("ADD_SELECTED_CALENDAR",(t,e)=>({calendarId:t,userIdentity:e})),O=(Object(r.action)("INITIALIZE_SELECTED_CALENDARS",(t,e)=>({calendarIds:t,userIdentity:e})),Object(r.action)("SELECTED_CALENDARS_UPDATED",(t,e)=>({calendarIds:t,userIdentity:e}))),m=Object(r.action)("REFRESH_IMMUTABLE_SELECTED_CALENDARS",t=>({userIdentity:t}));var p=n(225),v=n(36),j=n(57),C=n(704);const A="OWA.ViewStateConfiguration";function y(t,e){t&&j.u.importAndExecute([{key:"SelectedCalendarsDesktop",valuetype:"StringArray",value:Object(d.b)(t)}],A,Object(C.a)(Object(p.d)(e))).catch(t=>{v.h.warn("Could not save new selected calendars list to user configuration")})}Object(r.orchestrator)(b,t=>{const{calendarIds:e,userIdentity:n}=t;o(e,n),O(e,n),y(e,n)}),Object(r.orchestrator)(I,t=>{const{calendarId:e,userIdentity:n}=t;c(e,n);const r=f(n);O(r,n),y(r,n)});var E=n(2386);Object(r.orchestrator)(j.z,t=>{const{userConfiguration:e,userIdentity:n}=t;let r=e.ViewStateConfiguration.SelectedCalendarsDesktop;const c=n||Object(p.d)().userIdentity;Object(E.c)(r,c)?a(r,c):(o(r,c),O(r,c))});var h=n(2654);function S(t){return t?function(t){let e=s().get(t);return e?e.length:0}(t):function(){let t=s(),e=0;return t.forEach((t,n)=>{t&&(e+=t.length)}),e}()}function w(t){return!!i().selectedCalendars.get(t)}Object(r.orchestrator)(a,async t=>{const{ids:e,userIdentity:n}=t,r=await Object(h.b)(e,Object(E.b)(n),n,h.a.SelectedCalendars);b(r,n),m(n)}),n.d(e,"i",(function(){return b})),n.d(e,"a",(function(){return I})),n.d(e,"h",(function(){return O})),n.d(e,"g",(function(){return m})),n.d(e,"e",(function(){return f})),n.d(e,"c",(function(){return S})),n.d(e,"b",(function(){return s})),n.d(e,"d",(function(){return l})),n.d(e,"f",(function(){return w}))},579:function(t,e,n){"use strict";function r(t,e,n){return null==t?null:Object.assign({__typename:e},n?n(t):t)}function o(t,e,n){return(null==t?void 0:t.map(t=>r(t,e,n)))||null}n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return o}))},611:function(t,e,n){"use strict";function r(t){return Object.assign({__type:"FolderId:#Exchange"},t)}n.d(e,"a",(function(){return r}))},637:function(t,e,n){"use strict";n.d(e,"b",(function(){return u})),n.d(e,"c",(function(){return i})),n.d(e,"d",(function(){return d}));var r=n(824);n.d(e,"f",(function(){return r.c})),n.d(e,"e",(function(){return r.b}));var o=n(1015);n.d(e,"a",(function(){return o.a}));var c=n(20);const a=new c.c(()=>Promise.all([n.e(8),n.e(10),n.e(13),n.e(33),n.e(486)]).then(n.bind(null,1595))),u=new c.a(a,t=>t.initializeOwaAccountsStore),i=new c.a(a,t=>t.initializeOwaConnectedAccount),d=new c.a(a,t=>t.removeOWAConnectedAccount)},704:function(t,e,n){"use strict";function r(t,e){return t?Object.assign({mailboxInfo:t},e):null!=e?e:void 0}n.d(e,"a",(function(){return r}))},7721:function(t,e,n){"use strict";n.r(e);var r=n(843),o=n(3),c=n(2895),a=n(225),u=n(145),i=n(1040);Object(o.orchestrator)(r.c,async t=>{const{userId:e}=t,n=Object(c.e)(e||Object(a.d)().userIdentity);await Promise.all(n.filter(t=>Object(u.d)(t)&&Object(u.c)(t)).map(i.c))});var d=n(9204),s=n(11009);n.d(e,"initializeAccountAndCalendars",(function(){return d.a})),n.d(e,"initializeCalendarsDataForModule",(function(){return s.a}))},7812:function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return c}));var r=n(20);const o=new r.c(()=>n.e(1090).then(n.bind(null,13071)).then(t=>(t.initialize(),t)));let c=new r.a(o,t=>t.tryAutoSelect)},811:function(t,e,n){"use strict";function r(t={}){!function(t){t.timeBetweenRetryInMS=t.timeBetweenRetryInMS||(()=>6e4)}(t);const{maximumAttempts:e,timeBetweenRetryInMS:n}=t;return t=>{let r=0,o=!1;const c=(a,u)=>{o?u(new Error("The function retry was cancelled")):(r++,t().then(t=>a(t)).catch(t=>{e&&r>=e?u(t):setTimeout(()=>c(a,u),n(r))}))};return{retriableFunc:()=>new Promise((t,e)=>c(t,e)),cancel:()=>o=!0}}}function o(t){return e=>Math.pow(2,e)*t}n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return o}))},824:function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"c",(function(){return c})),n.d(e,"d",(function(){return a})),n.d(e,"b",(function(){return u}));var r=n(3);const o=Object(r.action)("initializeOwaAccountsStore"),c=Object(r.action)("owaConnectedAccountAdded",(t,e,n)=>({userIdentity:t,accountProviderType:e,source:n})),a=Object(r.action)("removeAccount",t=>({userIdentity:t})),u=Object(r.action)("owaAccountStoreInitializationFailed",(t,e,n,r)=>({userIdentity:t,isRetry:e,accountProvider:n,error:r}))},843:function(t,e,n){"use strict";var r=n(3),o=n(16);var c,a=Object(r.createStore)("cacheLoaderStore",{calendarAccountLoadMap:new o.ObservableMap({})});!function(t){t[t.Outlook=0]="Outlook",t[t.OutlookGroup=1]="OutlookGroup",t[t.TeamsCalendars=2]="TeamsCalendars"}(c||(c={}));var u=n(282),i=n(225);function d(t,e){switch(t){case c.Outlook:case c.OutlookGroup:return(e||Object(i.d)().userIdentity)+t.toString();case c.TeamsCalendars:return t.toString();default:return Object(u.a)(t)}}var s,l=n(57),f=n(47);function b(t,e){var n;const r=d(t,e);return(null===(n=a().calendarAccountLoadMap.get(r))||void 0===n?void 0:n.loadState)==s.Loaded}function I(t){return function(t){if(t&&t!==Object(l.b)()){const t=[c.Outlook];return Object(f.j)("cal-multiAccounts-groups")&&t.push(c.OutlookGroup),t}return[c.Outlook,c.OutlookGroup,c.TeamsCalendars]}(t).every(e=>b(e,t))}!function(t){t[t.Loading=0]="Loading",t[t.Loaded=1]="Loaded",t[t.Error=2]="Error"}(s||(s={}));const O=Object(r.mutatorAction)("addToAccounts",(t,e,n,r)=>{const o=a(),c={calendarEndpointType:n,userId:e,loadState:r};o.calendarAccountLoadMap.has(t)||o.calendarAccountLoadMap.set(t,c)}),m=Object(r.mutatorAction)("updateAccountLoadState",(t,e)=>{const n=a(),r=n.calendarAccountLoadMap.get(t);r.loadState=e,n.calendarAccountLoadMap.set(t,r)});var p=n(637),v=n(36);const j=Object(r.action)("calendarCacheInitializedForAccount",(t,e,n)=>({calendarEndpointType:t,userId:e,source:n}));var C=n(1040),A=n(1096),y=n(1094);var E=n(811);const h=Object(E.b)({maximumAttempts:3,timeBetweenRetryInMS:Object(E.a)(1e3)});var S=n(287),w=n(1091);const g={};function L(t,e){const n=e?e.userIdentity:Object(i.d)().userIdentity,r=Object(S.r)(n),o=d(t,n);if(O(o,n,t,s.Loading),b(t,n))return Promise.resolve();const a=g[o];if(a)return a.requestPromise;const l=h(()=>(async function(t,e){switch(t){case c.Outlook:await Object(C.f)(e);break;case c.OutlookGroup:await Object(A.b)(e);break;case c.TeamsCalendars:Object(f.j)("cal-showAddTeamsCalendars")&&await y.c.importAndExecute();break;default:Object(u.a)(t)}})(t,n)).retriableFunc();return g[o]={requestPromise:l},l.then(()=>{m(o,s.Loaded),j(t,n,null==e?void 0:e.source),r&&I(n)&&Object(w.a)(!0,n)}).catch(t=>{m(o,s.Error),v.d("initializeCalendarsCacheForAccount: failed to initialize calendar cache",t)})}async function G(){const t=L(c.Outlook),e=Object(S.n)().map(t=>{if(Object(l.h)(t.userIdentity)){const e={userIdentity:t.userIdentity,source:p.a.Init};L(c.Outlook,e)}});let n=[t,L(c.OutlookGroup),...e,L(c.TeamsCalendars)];if(Object(f.j)("cal-multiAccounts-groups")){const t=Object(S.n)().map(t=>{if(Object(l.h)(t.userIdentity)){const e={userIdentity:t.userIdentity,source:p.a.Init};L(c.OutlookGroup,e)}});n=n.concat(t)}await Promise.all(n)}function T(t,e){const{calendarAccountLoadMap:n}=a(),r=d(e,t);return n.get(r).loadState}Object(r.orchestrator)(p.f,t=>{const{userIdentity:e,source:n}=t,r={userIdentity:e,source:n};L(c.Outlook,r),Object(f.j)("cal-multiAccounts-groups")&&L(c.OutlookGroup,r)}),n.d(e,"g",(function(){return b})),n.d(e,"b",(function(){return I})),n.d(e,"f",(function(){return L})),n.d(e,"a",(function(){return c})),n.d(e,"c",(function(){return j})),n.d(e,"e",(function(){return G})),n.d(e,"d",(function(){return T}))},9204:function(t,e,n){"use strict";n.d(e,"a",(function(){return d}));var r=n(57),o=n(843),c=n(637),a=n(47),u=n(132),i=n(287);async function d(){await Object(o.e)();const t=Object(r.g)();Object(a.h)("cal-multiAccounts",()=>{var e,n;(Object(u.a)("multiAccounts")&&!Object(r.r)()&&!(null===(e=null==t?void 0:t.SessionSettings)||void 0===e?void 0:e.IsExplicitLogon)&&(null===(n=null==t?void 0:t.PolicySettings)||void 0===n?void 0:n.PersonalAccountCalendarsEnabled)||Object(i.s)())&&c.b.importAndExecute()})}}}]);
//# sourceMappingURL=owa.vendors~CalendarBootstrapUtils.js.map
self.scriptsLoaded = self.scriptsLoaded || {};self.scriptsLoaded['owa.vendors~CalendarBootstrapUtils.js'] = 1;