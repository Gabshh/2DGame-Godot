(window.$wj=window.$wj||[]).push([[11],{1783:function(e,t,n){"use strict";n.d(t,"h",(function(){return u})),n.d(t,"a",(function(){return c})),n.d(t,"c",(function(){return a})),n.d(t,"b",(function(){return s})),n.d(t,"e",(function(){return l})),n.d(t,"g",(function(){return f})),n.d(t,"k",(function(){return h})),n.d(t,"i",(function(){return d})),n.d(t,"d",(function(){return g})),n.d(t,"f",(function(){return m})),n.d(t,"j",(function(){return A}));var r=n(326),o=n(1694),i=n(2);let u=!1,c=void 0;const a=()=>Object(i.B)()==i.e?"OneOutlook":2===Object(o.c)()?"OwaCalendar":"OwaMail";let s=void 0,l=void 0,f=!1,h=!1,d=!1,g=void 0,p=void 0;const v="72f988bf-86f1-41af-91ab-2d7cd011db47",k="626bd560-f1d8-4cf1-a7fa-91aae03cc409";function m(e){if(!u){if(!e)throw new Error("Loki config object is mandatory!");s=e.isConsumer?"OwaConsumer":"OwaEnterprise",l=e.culture,f=e.isConsumer,h=e.useDogfood,p=e.logger,g=Object(i.u)();const t=e.tenantId&&e.tenantId.toLowerCase();d=t===v||t===k,c=e.clientCorrelationId||Object(r.a)()}u=!0}function A(e,t,n){p(e,[t,n])}},1811:function(e,t,n){"use strict";n.r(t);var r=n(2087);n.d(t,"getLokiBootstrapperConfig",(function(){return r.a}));var o=n(1783);n.d(t,"lokiClientCorrelationId",(function(){return o.a})),n.d(t,"isLokiInitialized",(function(){return o.h})),n.d(t,"initializeLoki",(function(){return o.f}));var i=n(2297);n.d(t,"lokiRequest",(function(){return i.a}));var u=n(2090);n.d(t,"fetchLokiConfigSync",(function(){return u.b}));var c=n(2089);n.d(t,"getLokiAuthTokenAsync",(function(){return c.a}));var a=n(1860);n.d(t,"getMidgardBootstrapperAsync",(function(){return a.b})),n.d(t,"initializeLivePersonaCardAsync",(function(){return a.c})),n.d(t,"initializeLivePersonaEditorAsync",(function(){return a.d})),n.d(t,"freeBootstrapperMemory",(function(){return a.a}))},1860:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return i})),n.d(t,"a",(function(){return u}));const r=()=>n.e(1900).then(n.t.bind(null,3929,7)),o=async e=>(await r()).initializeLivePersonaCardAsync(e),i=async e=>(await r()).initializeLivePersonaEditorAsync(e),u=async(e=window)=>(await r()).freeBootstrapperMemory(e)},2052:function(e,t,n){"use strict";var r=n(3),o=Object(r.createStore)("loki",{isInitialized:!1})();t.a=o},2077:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(287);function o(){return Object(r.s)()}},2087:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(2309),o=n(1783),i=n(2077),u=n(47),c=n(38),a=n(13),s=n(218);function l(){if(!o.h)throw new Error("You must call initializeLoki!");const e=Object(c.a)();let t=void 0;return Object(i.a)()&&(t=Object(s.a)().selectedSourceId),{culture:o.e,region:h(o.k,o.i),clientType:o.c(),clientContextType:o.b,clientCorrelationId:o.a,logMessage:(e,t,n)=>{o.j(e,t,n)},getAuthToken:(e,n)=>r.a.refreshAuthToken(e,n,t),authToken:r.a.getCachedAuthToken(t),complianceEnvironment:f(),isConsumer:o.g,tenantAadObjectId:e.SessionSettings.ExternalDirectoryTenantGuid,userAadObjectId:e.SessionSettings.ExternalDirectoryUserGuid,userPuid:e.SessionSettings.UserPuid,hostAppConfiguration:{isLivePersonaCardV2Enabled:Object(u.j)("lpc-isLPCV2Enabled")}}}function f(){switch(Object(a.h)()){case"BlackForest":return"Blackforest";case"GccHigh":return"GccHigh";case"DoD":return"DoD";case"Gallatin":return"Gallatin";case"AG08":return"AG08";case"AG09":return"AG09";default:return Object(u.j)("lpc-isInGccModerate")?"GccModerate":"Prod"}}function h(e,t){return e?"df":t?"msit":""}},2088:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2751);t.isLokiEndpoint=r.isLokiEndpoint;var o=n(2752);t.Base64=o;var i=n(2753);t.Functional=i;var u=n(2754);t.StorageUtils=u;var c=n(2311);t.StringUtils=c;var a=n(2757);t.getUrlParameter=a.getUrlParameter},2089:function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(71),o=n(47),i=n(2109),u=n(404),c=n(296),a=n(326),s=n(13);const l=(e,t)=>Object(u.getAccessTokenforResource)(Object(o.j)("fwk-application-settings")?Object(i.f)("Loki").resourceUrl:function(){switch(Object(s.h)()){case"BlackForest":return"https://loki.delve.office.de/";case"GccHigh":return"https://gcchigh.loki.office365.us/";case"DoD":return"https://dod.loki.office365.us/";case"Gallatin":return"https://loki.office365.cn/";case"AG08":case"AG09":return"https://loki.delve.office.com/";default:return Object(o.j)("lpc-isInGccModerate")?"https://gcc.loki.delve.office.com/":"https://loki.delve.office.com/"}}(),"loki",e,void 0,void 0,void 0,t),f=async e=>{const t=Object(a.a)(),n=new r.b("OwaPeopleLoki_GetLokiAadAuthTokenOperation");n.addCustomProperty("RequestId",t);try{let r=null;return r=Object(c.a)()?await Object(u.getDelegationTokenForOwa)("liveprofilecard.access","loki",t):await l(t,e),r?(n.end(),r):(n.endWithError("ServerError",Error("Token is empty.")),null)}catch(e){return n.endWithError("ClientError",Error("Unexpected error.")),null}}},2090:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return a}));var r=n(2087),o=n(2052),i=n(1860);let u=void 0;async function c(){if(u)return Promise.resolve(u);if(o.a.isInitialized){const e=Object(r.a)();return Object(i.b)().then(t=>t.fetchLokiConfigAsync(e)).then(e=>(u=e,u))}return null}function a(){if(u)return u;try{c()}catch(e){}return null}},2297:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(2090),o=n(1783),i=n(2309),u=n(226);async function c(e,t,n,c,a){const s=await Object(r.a)(),l=(await i.a.getAuthToken()).getValue();a||(a=new Headers),a.set("Accept","application/json"),a.set("Content-Type","application/json"),a.set("authorization",Object(u.a)(l)),a.set("X-ClientCorrelationId",o.a),a.set("X-ClientType",o.c()),a.set("X-ClientScenario",o.b),a.set("X-RefererUrl",""),a.set("X-ClientVersion",`16.${o.d.substr(0,4)}.${o.d.substr(4,4)}.${o.d.substr(8)}`);const f=function(e,t){const n=Object.keys(t);if(0===n.length)return e;const r=[];return n.forEach(e=>{const n=t[e];r.push(e+"="+encodeURIComponent(n||""))}),e+"?"+r.join("&")}(s.LokiUrl+t,n);return fetch(f,{method:e,headers:a,body:c})}},2309:function(e,t,n){"use strict";var r=n(2750),o=n(1783),i=n(2089);const u="fb12c587-80b7-4b4f-bf7d-da1f638f02f9";let c=void 0,a={};function s(e,t,n){Object(i.a)(n).then(i=>{const c=o.a;i?(!function(e,t){t?a[t]=e:(a[u]=e,Object(r.setAuthToken)(o.a,e))}(i,n),e(i,c)):t("Failed to get auth token from Loki",c)})}t.a={getAuthToken:function(e){return c||(c=new r.AuthTokenProvider(()=>o.a,function(e){return function(t){s((e,n)=>{t(e,"",n)},(e,n)=>{t("",e,n)},e)}}(e),null,null)),c.getAuthToken()},getCachedAuthToken:function(e){return e?a[e]:a[u]},refreshAuthToken:s}},2310:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2088),o=n(2088),i=function(){function e(e,t,n){this.value=e,this.scopeName=t,this.logger=n}return e.prototype.isValid=function(){if(!this.value)return!1;var e=this.extractAuthTokenExpiration();return e<=0?(this.logger&&this.logger.logError("InvalidTokenExpirationValue",this.scopeName,{expiryTime:e.toString()}),!1):!(Date.now()>1e3*e-3e5)||(this.logger&&this.logger.logEvent("CachedTokenExpired",this.scopeName),!1)},e.prototype.getValue=function(){return this.value},e.prototype.refresh=function(e){var t=this;return new Promise((function(n,o){var i=window.setTimeout((function(){o("GetAuthTokenTimeout")}),1e4);e((function(e,u,c){window.clearTimeout(i),r.StringUtils.isNullOrEmpty(u)?(t.value=e,n(t)):o("Couldn't retrieve token! authRequestCorrelationId: "+c)}))}))},e.prototype.getLoggableProps=function(){var e=1e3*this.extractAuthTokenExpiration();return{expirationTime:e,expiresIn:e-Date.now()}},e.prototype.getLoggablePropsAsString=function(){return JSON.stringify(this.getLoggableProps())},e.prototype.getTokenLifetimeBuffer=function(){return 3e5},e.prototype.extractAuthTokenOid=function(){var e=this.extractPayload();return e?e.oid:""},e.prototype.extractAuthTokenExpiration=function(){var e=this.extractPayload();return e?e.exp:0},e.prototype.extractPayload=function(){if(!this.value)return null;var e=this.value.split(".");if(3!==e.length)return this.logger&&this.logger.logError("AuthTokenParseError",this.scopeName,{partsCount:e.length.toString()}),null;try{return JSON.parse(o.Base64.decode(e[1]))}catch(e){return this.logger&&this.logger.logError("AuthTokenParseError",this.scopeName,{error:e}),null}},e}();t.AuthToken=i},2311:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="",o="00000000-0000-0000-0000-000000000000",i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";function u(e){return null==e||e===r}t.isNullOrEmpty=u,t.isNullOrWhitespace=function(e){return null==e||e.trim()===r},t.isGuidNullOrEmpty=function(e){return u(e)||e===o};var c=/(?:[\u3400-\u9FFF\uF900-\uFAFF]|[\uD840-\uD868][\uDC00-\uDFFF]|\uD869[\uDC00-\uDEDF]|\uD87E[\uDC00-\uDE1F])/;t.isCJK=function(e){return c.test(e)},t.generateGuid=function(){return i.replace(/[xy]/g,(function(e){var t;if(window.crypto){var n=new Uint8Array(1);window.crypto.getRandomValues(n),t=n[0]}else t=Math.floor(16*Math.random());return("x"===e?t%16:t%4+8).toString(16)}))},t.createCommaDelimitedParamStringFromObject=function(e){if("[object Object]"!==Object.prototype.toString.call(e))throw new TypeError("Param data must be a valid object");for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var o=r[n];t.push(o+"="+e[o])}return t.join(",")},t.format=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(!e)return r;if(null!=t&&t.length>0)for(var o=0;o<t.length;o++){var i=t[o],u=null==i?r:i.toString(),c=new RegExp("\\{"+o+"\\}","g");e=e.replace(c,u)}return e},t.toUTF8=function(e){return unescape&&encodeURIComponent?unescape(encodeURIComponent(e)):e},t.fromUTF8=function(e){return decodeURIComponent&&escape?decodeURIComponent(escape(e)):e}},2312:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2088),o=r.StorageUtils.getItem,i=r.StorageUtils.setItem,u=r.StorageUtils.removeItem,c="LokiAuthToken";t.setAuthTokenOnUrl=function(e,t){if(t&&r.isLokiEndpoint(e)){var n=e.indexOf("?")>-1?"&":"?";return""+e+n+"AuthToken="+t}return e},t.getAuthToken=function(e){return o(c,e||"")||""},t.setAuthToken=function(e,t){t&&i(c,t,e||"")},t.clearAuthToken=function(e){u(c,e||"")},t.removeAuthTokenFromUrl=function(e){return e?e.replace(/AuthToken=[\w-.]*[&$]?/,""):e}},2750:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2310);t.AuthToken=r.AuthToken;var o=n(2758);t.AuthTokenProvider=o.AuthTokenProvider;var i=n(2312);t.getAuthToken=i.getAuthToken,t.setAuthToken=i.setAuthToken,t.setAuthTokenOnUrl=i.setAuthTokenOnUrl,t.clearAuthToken=i.clearAuthToken,t.removeAuthTokenFromUrl=i.removeAuthTokenFromUrl},2751:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2311);t.isLokiEndpoint=function(e){return!r.isNullOrEmpty(e)&&new RegExp("^https://.+.loki.delve.office.com/.*","i").test(e)}},2752:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=/<%= spaceCharacters %>/g;function i(e){throw new Error(e).name="InvalidCharacterError",new Error(e)}t.decode=function(e){var t=(e=String(e).replace(o,"")).length;t%4==0&&(t=(e=e.replace(/==?$/,"")).length),(t%4==1||/[^+a-zA-Z0-9/]/.test(e))&&i("Invalid character: the string to be decoded is not correctly encoded.");for(var n,u=0,c=0,a="",s=-1;++s<t;)n=r.indexOf(e.charAt(s)),c=u%4?64*c+n:n,u++%4&&(a+=String.fromCharCode(255&c>>(-2*u&6)));return a},t.encode=function(e){e=String(e),/[^\0-\xFF]/.test(e)&&i("The string to be encoded contains characters outside of the 'Latin1 range.");for(var t,n=e.length%3,o="",u=-1,c=e.length-n;++u<c;)t=(e.charCodeAt(u)<<16)+(e.charCodeAt(++u)<<8)+e.charCodeAt(++u),o+=r.charAt(t>>18&63)+r.charAt(t>>12&63)+r.charAt(t>>6&63)+r.charAt(63&t);return 2===n?(t=(e.charCodeAt(u)<<8)+e.charCodeAt(++u),o+=r.charAt(t>>10)+r.charAt(t>>4&63)+r.charAt(t<<2&63)+"="):1===n&&(t=e.charCodeAt(u),o+=r.charAt(t>>2)+r.charAt(t<<4&63)+"=="),o}},2753:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filterOutNull=function(e){return e.filter((function(e){return null!=e}))},t.omitEmpty=function(e){return function(e,t){if(null==e)return e;for(var n={},r=0,o=Object.keys(e);r<o.length;r++){var i=o[r];t(e[i])&&(n[i]=e[i])}return n}(e,(function(e){return null!=e&&""!==e&&(!(e instanceof Array)||e.length>0)}))},t.updateWith=function(e,t){return Object.assign({},e,t)}},2754:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2755),o=n(2756);t.clear=function(e){r.clear(e),o.clear()},t.setItem=function(e,t,n){r.setItem(e,t,n),o.setItem(e,t)},t.getItem=function(e,t){var n=o.getItem(e);return void 0!==n?n:r.getItem(e,t)},t.removeItem=function(e,t){r.removeItem(e,t),o.removeItem(e)}},2755:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new Map;t.clear=function(e){r.delete(e)},t.setItem=function(e,t,n){var o=r.get(n)||new Map;o.set(e,t),r.set(n,o)},t.getItem=function(e,t){var n=r.get(t);return n?n.get(e):void 0},t.removeItem=function(e,t){var n=r.get(t);n&&n.delete(e)}},2756:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clear=function(){if(window.sessionStorage)try{window.sessionStorage.clear()}catch(e){}},t.setItem=function(e,t){if(window.sessionStorage)try{window.sessionStorage.setItem(e,t)}catch(e){}},t.getItem=function(e){if(window.sessionStorage)try{var t=window.sessionStorage.getItem(e);return null===t?void 0:t}catch(e){}},t.removeItem=function(e){if(window.sessionStorage)try{window.sessionStorage.removeItem(e)}catch(e){}}},2757:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getUrlParameter=function(e,t){void 0===t&&(t=window.location.search);var n=t.substr(1).split("&").map((function(e){return e.split("=").map((function(e){return decodeURIComponent(e)}))})).filter((function(t){return t[0]===e}));return n[0]&&n[0][1]}},2758:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2310),o=n(2312),i=function(){function e(e,t,n,o,i,u){void 0===i&&(i=r.AuthToken),void 0===u&&(u="RESTAuthToken"),this.getAppId=e,this.refreshAuthToken=t,this.logger=n,this.runWithLogMonitor=o,this.authTokenType=i,this.loggingFeature=u,this.getAuthToken()}return e.prototype.getAuthToken=function(){var e=this;return this.authToken&&this.authToken.isValid()?Promise.resolve(this.authToken):(this.authToken=new this.authTokenType(o.getAuthToken(this.getAppId()),this.loggingFeature,this.logger),this.authToken.isValid()?Promise.resolve(this.authToken):(this.authPromise=this.authPromise||new Promise((function(t,n){e.runWithLogMonitor?e.runWithLogMonitor({scenarioName:"LokiGetAuthToken",feature:e.loggingFeature,operation:function(){return e.authToken.refresh(e.refreshAuthToken)},successAction:function(n){e.onRefreshAuthTokenSuccess(n),t(n)},errorAction:function(t){e.onRefreshAuthTokenError(t),n(t)},treatAsExpectedError:function(e){return!!navigator&&!navigator.onLine}}):e.authToken.refresh(e.refreshAuthToken).then((function(n){e.onRefreshAuthTokenSuccess(n),t(n)})).catch((function(t){e.onRefreshAuthTokenError(t),n(t)}))})),this.authPromise))},e.prototype.onRefreshAuthTokenSuccess=function(e){this.authPromise=void 0,o.setAuthToken(this.getAppId(),e.getValue()||"")},e.prototype.onRefreshAuthTokenError=function(e){this.authPromise=void 0,this.logger&&this.logger.logError("LokiGetAuthTokenFailed",this.loggingFeature,{message:e})},e}();t.AuthTokenProvider=i}}]);
//# sourceMappingURL=owa.11.js.map
self.scriptsLoaded = self.scriptsLoaded || {};self.scriptsLoaded['owa.11.js'] = 1;