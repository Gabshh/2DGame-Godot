(window.$wj=window.$wj||[]).push([[810],{11903:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(35),a=n(9789);function i(t,e){return void 0===t||t.__type||(t=Object(a.a)(t)),Object(r.a)("GetAttachmentPreviews",t,e)}},1798:function(t,e,n){"use strict";n.d(e,"d",(function(){return s})),n.d(e,"l",(function(){return u})),n.d(e,"h",(function(){return d})),n.d(e,"f",(function(){return m})),n.d(e,"k",(function(){return l})),n.d(e,"j",(function(){return h})),n.d(e,"i",(function(){return v})),n.d(e,"g",(function(){return f})),n.d(e,"e",(function(){return w})),n.d(e,"m",(function(){return I}));var r=n(20),a=n(1905);n.d(e,"n",(function(){return a.a})),n.d(e,"o",(function(){return a.b})),n.d(e,"p",(function(){return a.c}));var i=n(1824);n.d(e,"a",(function(){return i.a}));var o=n(1957);n.d(e,"c",(function(){return o.a})),n.d(e,"b",(function(){return o.b}));const c=new r.c(()=>Promise.all([n.e(0),n.e(24),n.e(35),n.e(108),n.e(519)]).then(n.bind(null,3788))),s=new r.a(c,t=>t.addAndInitializeAttachments),u=new r.a(c,t=>t.setPreviewImageUrl),d=new r.a(c,t=>t.refreshDownloadUrl),m=new r.a(c,t=>t.createAttachmentInfo),l=new r.a(c,t=>t.setAttachmentInfo),h=new r.a(c,t=>t.refreshThumbnailImageUrl),v=new r.a(c,t=>t.refreshPreviewImageUrl),f=new r.b(c,t=>t.getAttachment),w=new r.b(c,t=>t.checkPendingAttachmentOperation),I=new r.b(c,t=>t.shouldShowImageView)},1824:function(t,e,n){"use strict";var r=n(16),a=n(3);const i={attachments:new r.ObservableMap({})},o=Object(a.createStore)("attachment",i);e.a=o},1905:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return o}));var r=n(3);const a=Object(r.action)("REFRESH_SHARING_TIPS_FOR_ATTACHMENT",t=>({attachmentId:t})),i=Object(r.action)("SET_ATTACHMENT_CONTENTID",(t,e)=>({attachmentId:t,attachmentContentId:e})),o=Object(r.action)("SET_ATTACHMENT_ISINLINE",(t,e)=>({attachmentId:t,isInline:e}))},1957:function(t,e,n){"use strict";function r(t){return(null==t?void 0:t.AttachmentId)&&a(t.AttachmentId.Id)}function a(t){return t&&-1!==t.indexOf("smime-")}n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return a}))},19663:function(t,e,n){"use strict";n.r(e);var r=n(702),a=n(1683),i=Object(r.action)("removeAttachmentPreviewsForRow")((function(t){const e=a.a.rowAttachmentPreviewWellViews,n=e.get(t);if(!n)return;const r=a.a.attachmentViewStates;n.imageViewStateIds.forEach(t=>{r.delete(t)}),n.documentViewStateIds.forEach(t=>{r.delete(t)}),e.delete(t)})),o=n(1798),c=n(2108),s=n(1692),u=n(3),d=n(326),m=n(47),l=n(16);const h=Object(u.mutatorAction)("setAttachmentViewStates",(t,e)=>{a.a.attachmentViewStates.set(t,e)}),v=Object(u.mutatorAction)("addAttachmentViewStateKey",(t,e,n)=>{e?t.imageViewStateIds.push(n):t.documentViewStateIds.push(n)}),f=Object(r.action)("processAttachmentPreviewsForItems")((function(t,e,n,r){const a=t.filter(t=>t.AttachmentPreviews),o={countOfAllPreviews:0,countOfLinkPreviews:0,invalidPreviewsInfo:""},c=[];a.forEach(t=>{c.push(...t.AttachmentPreviews.Previews)});const u=b(c,o);r.addCustomData(o);const d={};u.forEach(t=>{var n;const r=null===(n=t.ParentItemId)||void 0===n?void 0:n.Id;e.indexOf(r)>-1&&(d[r]||(d[r]=[]),d[r].push(t))}),e.forEach(t=>{const e=s.u.items.get(t);e?d[t]?w(t,d[t],n):(e.shouldShowAttachmentPreviews=!1,i(t)):delete d[t]})}));async function w(t,e,n){const r={documentViewStateIds:[],imageViewStateIds:[]};await Promise.all(e.map(async e=>{I(e),await async function(t,e,n,r,i){var s;const u=function(t,e){return t+"_"+e}(t,null===(s=n.AttachmentId)||void 0===s?void 0:s.Id);let d=a.a.attachmentViewStates.get(u);const m=l.observable.object(Object.assign(Object.assign({},n.AttachmentId),{mailboxInfo:i}));await c.d.import().then(async t=>{d=d||t(m,n,!0,!0,!1,!1,!1,e),n=(await o.g.import())(m).model,h(u,d);const a=await o.m.import();v(r,a(n),u)})}(t,Object.assign(Object.assign({},e.ParentItemId),{mailboxInfo:n}),e.Attachment,r,n)})),A(t,r)}const I=Object(u.mutatorAction)("addGuidIfNotPresent",t=>{var e,n;(null===(e=t.Attachment)||void 0===e?void 0:e.AttachmentId)&&!(null===(n=t.Attachment.AttachmentId)||void 0===n?void 0:n.Id)&&(t.Attachment.AttachmentId.Id=Object(d.a)())}),A=Object(u.mutatorAction)("setRowAttachmentPreviewWellViews",(t,e)=>{a.a.rowAttachmentPreviewWellViews.set(t,e)});function b(t,e){const n=t.filter(P);let r;if(n.length!==t.length){r=t.filter(t=>!P(t)).map(t=>(function(t){var e,n;const r=t.Attachment.AttachmentId?t.Attachment.AttachmentId.Id:"UNDEFINED",a=null===(e=t.ParentItemId)||void 0===e?void 0:e.Id,i=g(t),o=O(t);return`attachId=${r},isLink=${i},isLinkWoUrl=${o},hasNoName=${!t.Attachment.Name},noId=${!(null===(n=t.Attachment)||void 0===n?void 0:n.AttachmentId)},itemId=${a}`})(t)).join(";")}var a,i,o;return e&&(e.countOfAllPreviews+=t.length,e.countOfLinkPreviews+=t.filter(t=>g(t)).length,e.invalidPreviewsInfo=(a=e.invalidPreviewsInfo,i=r,o="|",a?[a,i].join(o):i)),n.filter(p)}function P(t){var e;return!!(null===(e=t.Attachment)||void 0===e?void 0:e.AttachmentId)&&!!t.Attachment.Name&&!O(t)}function g(t){const e=t.Attachment;return null==e?void 0:e.IsLink}function O(t){const e=t.Attachment;return(null==e?void 0:e.IsLink)&&!e.AttachLongPathName}function p(t){return!g(t)||Object(m.j)("doc-linkDiscovery-useNewProperty")}var j=n(71);const S=Object(r.action)("processAttachmentsForConversation")((function(t,e,n,r={listView:a.a}){var o,c;const s=r.listView.conversationItems.get(t.ConversationId.Id);if(!s)return;n.convCountWithHasLinkedFile+=s.hasSharepointLink?1:0;let u=[];if((null===(o=t.AttachmentPreviews)||void 0===o?void 0:o.Previews)&&(u=b(t.AttachmentPreviews.Previews,n)),s.hasSharepointLink&&!(null===(c=t.AttachmentPreviews)||void 0===c?void 0:c.Previews.some(t=>g(t)))&&n.convCountWithMissingLinkPreviews++,u.length>0){const n=function(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n],a=r.Attachment;let i=-1;if(a.IsInline)for(let t=0;t<e.length;t++){const n=e[t];if(n.Attachment.IsInline&&n.Attachment.Name==a.Name&&n.ParentItemId.Id!=r.ParentItemId.Id){i=t;break}}-1==i&&e.push(r)}return e}(u);w(t.ConversationId.Id,n,e);const r=u.length-n.length;r>0&&Object(j.p)("IP_II_DP",[r])}else s.shouldShowAttachmentPreviews=!1,i(t.ConversationId.Id),Object(j.p)("IP_FP")}));var C=n(11903),T=n(9789);function E(t,e,n){const r=Object(T.a)(Object.assign(Object.assign({},n),{ConversationIds:t}));return Object(C.a)(r,e).then(t=>t)}var V=n(1675),M=n(296),N=n(704);const k=new Map;function y(t,e,n,r={rowIdsToGetPreviewsMap:k}){let a=r.rowIdsToGetPreviewsMap[null==t?void 0:t.mailboxSmtpAddress];a||(a={conversationsIdsArray:[],itemIdsArray:[]},r.rowIdsToGetPreviewsMap[null==t?void 0:t.mailboxSmtpAddress]=a),a.conversationsIdsArray.some(t=>t.Id==e.Id)||a.conversationsIdsArray.push(e),-1==a.itemIdsArray.indexOf(n)&&a.itemIdsArray.push(n)}async function F(t,e,n={rowIdsToGetPreviewsMap:k}){const r=n.rowIdsToGetPreviewsMap[null==t?void 0:t.mailboxSmtpAddress];if(!r)return Promise.resolve();const a=r.conversationsIdsArray,i=r.itemIdsArray,o=Object(M.a)();delete n.rowIdsToGetPreviewsMap[null==t?void 0:t.mailboxSmtpAddress];const c=new j.b("GetAttachmentPreviews");try{return E(a,Object(N.a)(t),{IncludeInlineAttachments:o}).then(n=>{void 0!==n.Conversations?(1==e?f(n.Conversations,i,t,c):function(t,e,n){const r={countOfAllPreviews:0,countOfLinkPreviews:0,invalidPreviewsInfo:"",convCountWithHasLinkedFile:0,convCountWithMissingLinkPreviews:0};t.forEach(t=>{S(t,e,r)}),n.addCustomData(r)}(n.Conversations,t,c),c.end()):_(e,i,a,c)}).catch(()=>{_(e,i,a,c)})}catch(t){_(e,i,a,c)}return Promise.resolve()}const _=Object(u.mutatorAction)("handleGetAttachmentPreviewsFail",(t,e,n,r)=>{r.endWithError("ServerError"),1==t?e.forEach(t=>{const e=s.u.items.get(t);e&&(V.Z.rowAttachmentPreviewWellViews.get(t)||(e.shouldShowAttachmentPreviews=!1))}):n.forEach(t=>{const e=t.Id,n=V.Z.conversationItems.get(e);n&&(V.Z.rowAttachmentPreviewWellViews.get(e)||(n.shouldShowAttachmentPreviews=!1))})});function L(t){const e=[t],n=[],r={},a={};try{return E(e,Object(N.a)(t.mailboxInfo),{FullPreviewsPerConversation:300,PreviewsPerConversation:300,MinimumAttachmentSize:0,IncludeInlineAttachments:!1}).then(e=>(void 0!==e.Conversations&&e.Conversations.forEach(e=>{if(e.ConversationId.Id==t.Id&&e.AttachmentPreviews&&e.AttachmentPreviews.Previews){b(e.AttachmentPreviews.Previews,null).forEach(e=>{n.push(e.Attachment),r[e.Attachment.AttachmentId.Id]=Object.assign(Object.assign({},e.ParentItemId),{mailboxInfo:t.mailboxInfo}),a[e.Attachment.AttachmentId.Id]=e.ItemReceivedTime})}}),[n,r,a])).catch(()=>[n,r,a])}catch(t){}return Promise.resolve([n,r,a])}n.d(e,"getPreviews",(function(){return F})),n.d(e,"add",(function(){return y})),n.d(e,"getAttachmentsForConversationWell",(function(){return L})),n.d(e,"removeAttachmentPreviewsForRow",(function(){return i}))},2108:function(t,e,n){"use strict";n.d(e,"o",(function(){return c})),n.d(e,"r",(function(){return s})),n.d(e,"a",(function(){return u})),n.d(e,"q",(function(){return d})),n.d(e,"f",(function(){return m})),n.d(e,"u",(function(){return l})),n.d(e,"g",(function(){return h})),n.d(e,"d",(function(){return v})),n.d(e,"e",(function(){return f})),n.d(e,"j",(function(){return w})),n.d(e,"i",(function(){return I})),n.d(e,"l",(function(){return A})),n.d(e,"k",(function(){return b})),n.d(e,"c",(function(){return P})),n.d(e,"p",(function(){return g})),n.d(e,"s",(function(){return O})),n.d(e,"b",(function(){return p})),n.d(e,"m",(function(){return j})),n.d(e,"h",(function(){return S})),n.d(e,"t",(function(){return C})),n.d(e,"n",(function(){return T}));var r=n(20),a=n(2377);n.d(e,"v",(function(){return a.a}));var i=n(2378);n.d(e,"w",(function(){return i.a}));const o=new r.c(()=>Promise.all([n.e(0),n.e(8),n.e(10),n.e(13),n.e(319)]).then(n.bind(null,4005))),c=new r.a(o,t=>t.initializeAttachments),s=new r.a(o,t=>t.reinitializeAttachments),u=(new r.a(o,t=>t.setInlineAttachmentStatus),new r.a(o,t=>t.addAttachmentIntoWellBeforeUpload)),d=new r.b(o,t=>t.refreshSharingTipsAttachmentWell),m=new r.b(o,t=>t.createAttachmentsViaQueueManager),l=new r.b(o,t=>t.createAttachmentsFromRecentAttachments),h=new r.a(o,t=>t.deleteAttachmentViaQueueManager),v=new r.b(o,t=>t.createAttachmentFullViewStateAndStoreBackingModel),f=new r.b(o,t=>t.createAttachmentFullViewState),w=new r.b(o,t=>t.getAttachmentWellInitialValue),I=new r.b(o,t=>t.getAttachmentWellForCompose),A=new r.b(o,t=>t.getConversationAttachmentWellInitialValue),b=(new r.b(o,t=>t.getMaxClassicAttachmentsSize),new r.b(o,t=>t.getAvailableLocalAttachmentSize)),P=new r.b(o,t=>t.createAttachmentFileFromExistingMailboxAttachment),g=new r.a(o,t=>t.mergeToConversationAttachmentWell),O=new r.a(o,t=>t.sortConversationAttachmentWell),p=new r.a(o,t=>t.convertImageViewAttachmentToInlineAttachment),j=new r.b(o,t=>t.getLastCloudyAttachmentsSharingIssueForBlockOnSend),S=new r.b(o,t=>t.getAllValidAttachments),C=new r.b(o,t=>t.uploadLocalFile),T=new r.b(o,t=>t.getShouldShareAttachmentProperties)},2377:function(t,e,n){"use strict";var r=n(3);e.a=Object(r.action)("ON_ATTACHMENT_CREATED",(t,e,n,r=!0)=>({parentItemId:t,attachmentId:e,attachment:n,shouldTriggerAddInAttachmentsChangedCallback:r}))},2378:function(t,e,n){"use strict";var r=n(3);e.a=Object(r.action)("ON_ATTACHMENT_DELETED",(t,e,n,r=!0)=>({parentItemId:t,attachmentId:e,attachment:n,shouldTriggerAddInAttachmentsChangedCallback:r}))},326:function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return o}));const r=/^[0-9a-z]{8}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{12}$/;function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function i(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function o(t){return r.test(t)}},704:function(t,e,n){"use strict";function r(t,e){return t?Object.assign({mailboxInfo:t},e):null!=e?e:void 0}n.d(e,"a",(function(){return r}))},9789:function(t,e,n){"use strict";function r(t){return Object.assign({__type:"GetAttachmentPreviewsRequest:#Exchange"},t)}n.d(e,"a",(function(){return r}))}}]);
//# sourceMappingURL=owa.810.js.map
self.scriptsLoaded = self.scriptsLoaded || {};self.scriptsLoaded['owa.810.js'] = 1;